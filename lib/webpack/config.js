const path=require("path"),HtmlWebpackPlugin=require("html-webpack-plugin"),CopyWebpackPlugin=require("copy-webpack-plugin"),{generateBasicWebpackConfig}=require("./baseconfig");function proxyConfigToDevServer(a){const b=a.dev.proxy,c={};return Array.isArray(b)&&b.length&&b.forEach(b=>{if(b.from&&b.to&&(c[b.from]={target:b.to,changeOrigin:!0,cookieDomainRewrite:"localhost"},a.dev.mock)){const d=require(path.resolve(process.cwd(),a.dev.mock));c[b.from].bypass=d}}),c}function generateWebpackConfig(a,b="production"){const c=generateBasicWebpackConfig(a,b);return c.output={path:a.dist,filename:"production"===b?"js/[name].[hash:6].js":"js/[name].js",publicPath:"production"===b?a.cdn||"/":"/"},c.optimization={splitChunks:{chunks:"all"}},c.devServer={port:a.port,hot:!0,historyApiFallback:{rewrites:[{from:/.*/,to:"/index.html"}]},proxy:proxyConfigToDevServer(a)},c.plugins.push(new HtmlWebpackPlugin({template:path.resolve(a.src,a.template)})),a.static&&c.plugins.push(new CopyWebpackPlugin({patterns:[{from:a.static,to:a.dist}]})),c}module.exports={generateWebpackConfig};