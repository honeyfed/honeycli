const{CdnUploader}=require("../util/cdn"),{loadHoneyConfig}=require("../util/config"),{getFiles}=require("../util/utils"),print=require("../util/print"),path=require("path");function normalizePath(a,b,c){return path.join(a,path.relative(b,c)).replaceAll("\\","/")}async function cdnCmd(){const a=new CdnUploader;if(!a.init())return void print.error("cos\u521D\u59CB\u5316\u5931\u8D25");const b=loadHoneyConfig(),c=b.dist;let d=await getFiles(c+"/js/**/*.js"),e=await getFiles(c+"/style/**/*.css"),f=await getFiles(c+"/imgs/**/*"),g=await getFiles(c+"/fonts/**/*");d=d.map(a=>({cdnPath:normalizePath(b.packageName,b.dist,a),filePath:a})),e=e.map(a=>({cdnPath:normalizePath(b.packageName,b.dist,a),filePath:a})),f=f.map(a=>({cdnPath:normalizePath(b.packageName,b.dist,a),filePath:a})),g=g.map(a=>({cdnPath:normalizePath(b.packageName,b.dist,a),filePath:a})),d.forEach(async b=>{try{await a.uploadFile(b.cdnPath,b.filePath),print.info(`已上传${b.filePath}`)}catch(a){print.error(a),print.error(`${b.filePath}上传失败`)}}),e.forEach(async b=>{try{await a.uploadFile(b.cdnPath,b.filePath),print.info(`已上传${b.filePath}`)}catch(a){print.error(a),print.error(`${b.filePath}上传失败`)}}),f.forEach(async b=>{try{await a.uploadFile(b.cdnPath,b.filePath),print.info(`已上传${b.filePath}`)}catch(a){print.error(a),print.error(`${b.filePath}上传失败`)}}),g.forEach(async b=>{try{await a.uploadFile(b.cdnPath,b.filePath),print.info(`已上传${b.filePath}`)}catch(a){print.error(a),print.error(`${b.filePath}上传失败`)}})}module.exports={cdnCmd};