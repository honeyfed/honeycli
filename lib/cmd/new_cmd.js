const{makeGithubUrlForTbTemplate,isValidName,rm,getFiles}=require("../util/utils"),{gitClone}=require("../git/git"),{GitError}=require("../util/errors"),inquirer=require("inquirer"),{loadTemplates}=require("../util/config"),print=require("../util/print"),fs=require("fs"),path=require("path"),{renderInPlaceSync}=require("../util/template");async function newCmd(){try{const a=await loadTemplates();if(!a)throw new Error("\u672A\u627E\u5230\u6A21\u677F");// ask project name
const b=await inquirer.prompt([{type:"input",name:"projectName",message:"project name",validate:a=>a?!!isValidName(a)||"invalid project name(only alphabet number _ - were allowed)":"project name should not be empty"},{type:"list",name:"template",message:"choose template",choices:()=>a.map(a=>({name:`${a.name} (${a.description}) - ${a.valid?"valid":"invalid"}`,value:a}))}]);if(b.template.valid){const a=makeGithubUrlForTbTemplate(b.template.name);await gitClone(a,b.projectName),await rm(b.projectName+"/.git");// template render
const c=await getFiles(b.projectName+"/**/*");c.forEach(a=>{if(fs.lstatSync(a).isFile()){print.info(`正在写入${a}`);const c=path.extname(a);/\.(txt|markdown|md|js|jsx|vue|html|json|less|css|scss|styl)$/i.test(c)&&renderInPlaceSync(a,{name:b.projectName})}})}else throw new Error("invalid template: "+b.template.name)}catch(a){a instanceof GitError?print.error(a.message):print.error(a)}}module.exports={newCmd};